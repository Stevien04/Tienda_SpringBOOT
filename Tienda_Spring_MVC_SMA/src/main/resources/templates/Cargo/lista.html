<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gestión de cargos</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      margin: 0;
      background-color: #f5f5f5;
      color: #1f2933;
    }

    .contenedor {
      max-width: 960px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .buscador {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .buscador label {
      font-weight: 600;
      color: #334155;
    }

    .buscador input[type="text"] {
      padding: 0.55rem 0.9rem;
      border-radius: 0.5rem;
      border: 1px solid #94a3b8;
      min-width: 220px;
      font-size: 0.95rem;
    }

    .buscador button {
      padding: 0.55rem 1rem;
      border-radius: 0.5rem;
      border: none;
      background-color: #0b7285;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
    }

    .buscador button:hover {
      background-color: #0a5d6b;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
      color: #0b7285;
    }

    .boton {
      display: inline-block;
      padding: 0.6rem 1.2rem;
      background-color: #0b7285;
      color: #ffffff;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .boton:hover {
      background-color: #0a5d6b;
    }

    .boton.toggle {
      background-color: #adb5bd;
      color: #212529;
      font-weight: 600;
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
    }

    .boton.toggle.activo {
      background-color: #0b7285;
      color: white;
    }

    .alerta {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }

    .alerta.exito {
      background-color: #d3f9d8;
      color: #2b8a3e;
    }

    .alerta.error {
      background-color: #ffe3e3;
      color: #c92a2a;
    }

    section {
      display: grid;
      gap: 2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #ffffff;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 0.5rem 1.5rem rgba(15, 23, 42, 0.1);
    }

    thead {
      background-color: #0b7285;
      color: #ffffff;
      text-align: left;
    }

    th, td {
      padding: 0.9rem 1rem;
      font-size: 0.95rem;
    }

    tbody tr:nth-child(even) {
      background-color: #f1f5f9;
    }

    .acciones {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .acciones a,
    .acciones button {
      padding: 0.4rem 0.8rem;
      border-radius: 0.4rem;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      text-decoration: none;
    }

    .acciones a {
      background-color: #364fc7;
      color: #ffffff;
    }

    .acciones a:hover {
      background-color: #2c3ea5;
    }

    .acciones button.activar {
      background-color: #2b8a3e;
      color: #ffffff;
    }

    .acciones button.desactivar {
      background-color: #e03131;
      color: #ffffff;
    }

    .vacio {
      padding: 1rem;
      text-align: center;
      color: #495057;
    }

    .oculto {
      display: none;
    }

    .fondo-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .ventana-modal {
      background-color: white;
      padding: 2rem;
      border-radius: 0.8rem;
      box-shadow: 0 0.75rem 2rem rgba(0,0,0,0.25);
      max-width: 450px;
      width: 100%;
    }

    .ventana-modal h2 {
      margin-top: 0;
      color: #0b7285;
    }

    .ventana-modal form {
      display: grid;
      gap: 1rem;
    }

    .ventana-modal input {
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .cerrar {
      background-color: #adb5bd;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
    }

    .cerrar:hover {
      background-color: #868e96;
    }
  </style>
</head>

<body>
  <main class="contenedor">
    <header>
      <h1>Gestión de cargos</h1>
      <button class="boton" onclick="abrirModal()">Registrar cargo</button>
    </header>

    <div th:if="${exito}" class="alerta exito" th:text="${exito}"></div>
    <div th:if="${error}" class="alerta error" th:text="${error}"></div>

    <!-- Buscador reactivo -->
    <form class="buscador" method="get" action="/cargo">
      <label for="busqueda">Buscar por nombre:</label>
      <input id="busqueda" type="text" name="q" th:value="${busqueda}"
             placeholder="Ej. Supervisor"
             pattern="[A-Za-zÁÉÍÓÚÜÑáéíóúüñ ]*"
             oninput="buscarAuto(this)">
      <button type="submit">Buscar</button>
    </form>

    <div style="margin-bottom: 1rem;">
      <button id="btnActivos" class="boton toggle activo" onclick="mostrarTabla('activos')">Ver Activos</button>
      <button id="btnInactivos" class="boton toggle" onclick="mostrarTabla('inactivos')">Ver Inactivos</button>
    </div>

    <section>
      <!-- Tabla de cargos activos -->
      <article id="tablaActivos">
        <h2>Cargos activos</h2>
        <table th:if="${activos != null and !#lists.isEmpty(activos)}">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="cargo : ${activos}">
              <td th:text="${cargo.nombre}"></td>
              <td>Activo</td>
              <td>
                <div class="acciones">
                  <a th:href="@{'/cargo/' + ${cargo.idCargo} + '/editar'}">Editar</a>
                  <form th:action="@{'/cargo/' + ${cargo.idCargo} + '/estado'}" method="post">
                    <button type="submit" class="desactivar">Desactivar</button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="vacio" th:if="${activos == null or #lists.isEmpty(activos)}">
          <th:block th:if="${#strings.isEmpty(busqueda)}">
            No hay cargos activos registrados.
          </th:block>
          <th:block th:unless="${#strings.isEmpty(busqueda)}">
            No se encontraron cargos activos que coincidan con 
            "<span th:text="${busqueda}"></span>".
          </th:block>
        </div>
      </article>

      <!-- Tabla de cargos inactivos -->
      <article id="tablaInactivos" class="oculto">
        <h2>Cargos inactivos</h2>
        <table th:if="${inactivos != null and !#lists.isEmpty(inactivos)}">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="cargo : ${inactivos}">
              <td th:text="${cargo.nombre}"></td>
              <td>Inactivo</td>
              <td>
                <div class="acciones">
                  <a th:href="@{'/cargo/' + ${cargo.idCargo} + '/editar'}">Editar</a>
                  <form th:action="@{'/cargo/' + ${cargo.idCargo} + '/estado'}" method="post">
                    <button type="submit" class="activar">Activar</button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="vacio" th:if="${inactivos == null or #lists.isEmpty(inactivos)}">
          <th:block th:if="${#strings.isEmpty(busqueda)}">
            No hay cargos inactivos.
          </th:block>
          <th:block th:unless="${#strings.isEmpty(busqueda)}">
            No se encontraron cargos inactivos que coincidan con 
            "<span th:text="${busqueda}"></span>".
          </th:block>
        </div>
      </article>
    </section>
  </main>

  <!-- Modal de registro -->
  <div id="modalCargo" class="fondo-modal">
    <div class="ventana-modal">
      <h2>Registrar nuevo cargo</h2>
      <form th:action="@{/cargo/nuevo}" method="post">
        <label>Nombre del cargo</label>
        <input type="text" name="nombre" maxlength="20" required placeholder="Ej. Supervisor"
               pattern="[A-Za-zÁÉÍÓÚÜÑáéíóúüñ ]+"
               oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s]/g, '')">

        <div style="text-align:right;">
          <button type="button" class="cerrar" onclick="cerrarModal()">Cancelar</button>
          <button type="submit" class="boton">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function mostrarTabla(tipo) {
      const activos = document.getElementById("tablaActivos");
      const inactivos = document.getElementById("tablaInactivos");
      const btnActivos = document.getElementById("btnActivos");
      const btnInactivos = document.getElementById("btnInactivos");

      if (tipo === "activos") {
        activos.classList.remove("oculto");
        inactivos.classList.add("oculto");
        btnActivos.classList.add("activo");
        btnInactivos.classList.remove("activo");
      } else {
        activos.classList.add("oculto");
        inactivos.classList.remove("oculto");
        btnInactivos.classList.add("activo");
        btnActivos.classList.remove("activo");
      }
    }

    function abrirModal() {
      document.getElementById("modalCargo").style.display = "flex";
    }

    function cerrarModal() {
      document.getElementById("modalCargo").style.display = "none";
    }

    // Búsqueda automática
    function buscarAuto(input) {
      const valor = input.value.trim();
      if (valor === '') {
        window.location.href = '/cargo';
      }
    }
  </script>
</body>
</html>
